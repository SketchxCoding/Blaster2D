(()=>{"use strict";function t(t,e){return Math.round(Math.random()*(e-t))+t}class e extends Phaser.GameObjects.Text{constructor(t,e,i,s,h){h||((h={}).fontFamily="Arial",h.fontSize=30,h.background=255),"fontFamily"in h||(h.fontFamily="Arial"),"fontSize"in h||(h.fontSize=30),super(t,e,i,s,h),this.scrollFactorX=0,this.scrollFactorY=0,this.setDepth(100),t.add.existing(this)}}const i=e;class s extends Phaser.GameObjects.Container{constructor(t,e,s,h,n,o){super(t),o||((o={}).fontSize=50,o.fontFamily="Arial",o.background=255),"fontSize"in o||(o.fontSize=50),"fontFamily"in o||(o.fontFamily="Arial"),"background"in o||(o.background=255),this.text=new i(t,e,s,h,{fontSize:o.fontSize,fontFamily:o.fontFamily}).setOrigin(.5),this.button=t.add.rectangle(0,0,0,0,o.background).setDepth(99),this.button.scrollFactorX=0,this.button.scrollFactorY=0,this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",n),t.add.existing(this)}}const h=s,n=JSON.parse('{"T":[{"id":0,"size":312,"x":2093,"y":1084},{"id":1,"size":207,"x":1287.5,"y":1616.5},{"id":2,"size":255,"x":334.5,"y":1532.5},{"id":3,"size":516,"x":1228,"y":927},{"id":4,"size":336,"x":3796,"y":3675},{"id":5,"size":519,"x":3359.5,"y":1966.5},{"id":6,"size":162,"x":1140,"y":694},{"id":7,"size":252,"x":4001,"y":1682},{"id":8,"size":369,"x":4361.5,"y":2174.5},{"id":9,"size":399,"x":4668.5,"y":2054.5},{"id":10,"size":549,"x":285.5,"y":388.5},{"id":11,"size":405,"x":1390.5,"y":4544.5},{"id":12,"size":336,"x":1786,"y":3608},{"id":13,"size":534,"x":3169,"y":2193},{"id":14,"size":156,"x":1897,"y":4071},{"id":15,"size":510,"x":1780,"y":3230},{"id":16,"size":579,"x":1086.5,"y":2531.5},{"id":17,"size":351,"x":1763.5,"y":2789.5},{"id":18,"size":291,"x":814.5,"y":3170.5},{"id":19,"size":579,"x":1838.5,"y":507.5},{"id":20,"size":240,"x":902,"y":892},{"id":21,"size":447,"x":1977.5,"y":2417.5},{"id":22,"size":531,"x":740.5,"y":1142.5},{"id":23,"size":474,"x":881,"y":2080},{"id":24,"size":306,"x":4163,"y":1211},{"id":25,"size":285,"x":2756.5,"y":1307.5},{"id":26,"size":486,"x":3183,"y":2590},{"id":27,"size":573,"x":1848.5,"y":4449.5},{"id":28,"size":300,"x":1144,"y":2965},{"id":29,"size":570,"x":4155,"y":3296},{"id":30,"size":513,"x":596.5,"y":4507.5},{"id":31,"size":192,"x":1311,"y":2194},{"id":32,"size":522,"x":599,"y":389},{"id":33,"size":555,"x":4060.5,"y":3345.5},{"id":34,"size":336,"x":3867,"y":3121},{"id":35,"size":453,"x":1492.5,"y":3538.5},{"id":36,"size":405,"x":2962.5,"y":4772.5},{"id":37,"size":573,"x":2819.5,"y":1264.5},{"id":38,"size":432,"x":4225,"y":3817},{"id":39,"size":486,"x":1132,"y":3599},{"id":40,"size":534,"x":2165,"y":3379},{"id":41,"size":540,"x":959,"y":651},{"id":42,"size":246,"x":4709,"y":4282},{"id":43,"size":189,"x":2940.5,"y":1070.5},{"id":44,"size":405,"x":4247.5,"y":2034.5},{"id":45,"size":558,"x":4425,"y":3810},{"id":46,"size":468,"x":1994,"y":912},{"id":47,"size":429,"x":2287.5,"y":313.5},{"id":48,"size":156,"x":3914,"y":4800},{"id":49,"size":291,"x":677.5,"y":258.5},{"id":50,"size":363,"x":692.5,"y":1733.5},{"id":51,"size":495,"x":298.5,"y":393.5},{"id":52,"size":258,"x":1290,"y":3787},{"id":53,"size":531,"x":489.5,"y":4529.5},{"id":54,"size":327,"x":1839.5,"y":4462.5}]}'),o=JSON.parse('[{"id":0,"url":"player","cost":0},{"id":1,"url":"skull","cost":200},{"id":2,"url":"smileyface","cost":100},{"id":3,"url":"target","cost":100}]');class a extends Phaser.Scene{constructor(){super(),this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.frames=0}preload(){for(let t of Object.keys(o))this.load.image(`skin_${o[t].id}`,`/img/skins/${o[t].url}.png`);this.load.image("player","/img/skins/player.png"),this.load.image("coin","/img/gameObjects/coin.png"),this.load.image("grass","/img/gameObjects/tile.png"),this.load.image("bullet","/img/gameObjects/bullet.png"),this.load.image("pistol","/img/guns/pistol.png"),this.load.image("obstacle","/img/gameObjects/obstacle.png"),this.load.image("obstacle2","/img/gameObjects/obstacle2.png"),this.load.image("tree","/img/gameObjects/tree.png"),this.loadingtext=new i(this,window.innerWidth/2,window.innerHeight/2,"Loading...",{fontSize:100}).setOrigin(.5)}create(){this.loaded=!1,this.socket=io("https://blaster2d.ruiwenge2.repl.co"),this.coins=this.physics.add.group(),this.trees=this.physics.add.group(),this.enemies={},this.socket.emit("join",localStorage.getItem("name")),this.socket.on("gamedata",(t=>{this.loaded=!0,this.loadingtext.destroy(),this.player=this.physics.add.sprite(t.players[this.socket.id].x,t.players[this.socket.id].y,"player").setScale(.65,.65).setDepth(1),this.fpstext=new i(this,window.innerWidth-150,120,"FPS:",{fontSize:25}),this.tps=new i(this,window.innerWidth-150,155,"TPS:",{fontSize:25}),this.playerInfo={x:this.player.x,y:this.player.y},this.cameras.main.startFollow(this.player),this.data={x:t.players[this.socket.id].x,y:t.players[this.socket.id].y,angle:0,angle2:0};for(let e of t.coins)this.coins.create(e.x,e.y,"coin").setScale(.75,.75).setDepth(1).id=e.id;for(let t of n.T)this.trees.create(t.x,t.y,"tree").setScale(t.size/300).setDepth(10).setAlpha(.7).id=t.id;for(let e of Object.keys(t.players))e!=this.socket.id&&this.addPlayer(t.players[e]);this.main()})),this.socket.on("new player",((t,e)=>{this.addPlayer(t)})),this.socket.on("collected gold",(t=>{for(let e of this.coins.children.entries)e.id==t&&e.destroy()})),this.socket.on("left",(t=>{this.enemies[t].player.destroy()})),this.socket.on("leave",(()=>{this.scene.start("disconnect_scene")}))}main(){setInterval((()=>{this.tps.setText("TPS: "+this.frames),this.frames=0}),1e3),this.w=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.a=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.s=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.d=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);for(let t=250;t<5e3;t+=500)for(let e=250;e<5e3;e+=500)this.physics.add.image(t,e,"grass").setDepth(0);this.obstacle1=this.physics.add.staticSprite(2500,1750,"obstacle").setDepth(0),this.obstacle2=this.physics.add.staticSprite(2500,3250,"obstacle").setDepth(0),this.obstacle3=this.physics.add.staticSprite(1750,2500,"obstacle2").setDepth(0),this.obstacle4=this.physics.add.staticSprite(3250,2500,"obstacle2").setDepth(0),this.gun=this.physics.add.sprite(this.player.x,this.player.y,"pistol").setDepth(1),this.gun.angle2=0,this.bullets=this.physics.add.group(),this.health=100,this.score=0,this.scoretext=new i(this,window.innerWidth-150,50,"Score: "+this.score,{fontSize:25}),this.gold=0,this.goldtext=new i(this,window.innerWidth-150,85,"Gold: "+this.gold,{fontSize:25}),this.addWeaponActions();var t=this;this.healFunction=setInterval((function(){t.health<100&&(t.health+=1,t.updateHealthBar())}),1e3),this.physics.add.collider(this.player,this.coins,((t,e)=>{this.collect(t,e)})),this.physics.add.collider(this.bullets,this.obstacle1,((t,e)=>{e.destroy()})),this.physics.add.collider(this.player,this.obstacle1,(()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)})),this.physics.add.collider(this.bullets,this.obstacle2,((t,e)=>{e.destroy()})),this.physics.add.collider(this.player,this.obstacle2,(()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)})),this.physics.add.collider(this.bullets,this.obstacle3,((t,e)=>{e.destroy()})),this.physics.add.collider(this.player,this.obstacle3,(()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)})),this.physics.add.collider(this.bullets,this.obstacle4,((t,e)=>{e.destroy()})),this.physics.add.collider(this.player,this.obstacle4,(()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)})),this.socket.on("gamestate",(t=>{this.frames+=1;let e=t.players[this.socket.id];this.playerInfo.x=e.x,this.playerInfo.y=e.y,this.tweens.add({targets:this.player,x:this.playerInfo.x,y:this.playerInfo.y,duration:100});for(let e of Object.keys(t.players))e!=this.socket.id&&this.tweens.add({targets:[this.enemies[e].player,this.enemies[e].gun],x:t.players[e].x,y:t.players[e].y,duration:100})}))}addPlayer(t){var e={id:t.id,x:t.x,y:t.y,player:this.add.image(t.x,t.y,"player").setScale(.65,.65).setDepth(1),gun:this.add.image(t.x+32.5,t.y,"pistol").setDepth(15),angle:null,healthbar:void 0,nametext:void 0};this.enemies[t.id]=e}updatePlayers(t){}collect(e,i){this.socket.emit("collect gold",i.id),this.gold+=1,this.goldtext.setText("Gold: "+this.gold),i.destroy(),this.gold>localStorage.getItem("bestgold")&&localStorage.setItem("bestgold",this.gold);for(let e=0;e<t(0,2);e++)this.coins.create(t(18.75,4981.25),t(18.75,4981.25),"coin").setScale(.75,.75)}updateHealthBar(){this.health<0&&(this.health=0),this.healthbarinside.width=200*this.health/100}addWeaponActions(){this.useweapon=!0,window.addEventListener("mousedown",(t=>{if(!this.useweapon)return;var e=Math.atan2(t.clientY-window.innerHeight/2,t.clientX-window.innerWidth/2);let i=this.bullets.create(this.player.x+55.5*Math.cos(e),this.player.y+55.5*Math.sin(e),"bullet").setScale(.5,2).setDepth(13);i.angle=(180*e/Math.PI+360)%360,i.setVelocityX(1500*Math.cos(e)),i.setVelocityY(1500*Math.sin(e)),this.gun.angle=(180*e/Math.PI+360)%360,this.gun.angle2=e,this.useweapon=!1})),window.addEventListener("mousemove",(t=>{var e=Math.atan2(t.clientY-window.innerHeight/2,t.clientX-window.innerWidth/2);this.gun.angle=(180*e/Math.PI+360)%360,this.gun.angle2=e})),setInterval((()=>{this.useweapon||(this.useweapon=!0)}),500)}update(){if(!this.loaded)return;this.fpstext.setText("FPS: "+Math.round(this.sys.game.loop.actualFps));let t=this.input.keyboard.createCursorKeys();t.left.isDown||this.a.isDown?this.left||(this.socket.emit("movement","left"),this.left=!0,this.right=!1):this.left&&(this.socket.emit("movement_end","left"),this.left=!1),t.right.isDown||this.d.isDown?this.right||(this.socket.emit("movement","right"),this.right=!0,this.left=!1):this.right&&(this.socket.emit("movement_end","right"),this.right=!1),t.up.isDown||this.w.isDown?this.up||(this.socket.emit("movement","up"),this.up=!0,this.down=!1):this.up&&(this.socket.emit("movement_end","up"),this.up=!1),t.down.isDown||this.s.isDown?this.down||(this.socket.emit("movement","down"),this.down=!0,this.up=!1):this.down&&(this.socket.emit("movement_end","down"),this.down=!1),this.gun.x=this.player.x+61.5*Math.cos(this.gun.angle2),this.gun.y=this.player.y+61.5*Math.sin(this.gun.angle2),this.player.angle=this.gun.angle,this.player.x==this.data.x&&this.player.y==this.data.y&&this.player.angle==this.data.angle||(this.data.angle=this.gun.angle,this.data.angle2=this.gun.angle2,this.data.gunx=this.gun.x,this.data.guny=this.gun.y)}}const d=a;class l extends Phaser.Scene{constructor(){super()}preload(){}create(){localStorage.getItem("bestscore")||localStorage.setItem("bestscore",0),localStorage.getItem("bestgold")||localStorage.setItem("bestgold",0),this.add.text(window.innerWidth/2,100,"Game",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/2.5,"Play",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",(()=>{this.scene.start("gamescene")})),this.button2=this.add.rectangle(0,0,0,0,240),this.text2=this.add.text(window.innerWidth/2,window.innerHeight/1.8,"How To Play",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button2.width=this.text2.width+15,this.button2.height=this.text2.height+15,this.button2.x=this.text2.x-this.text2.width/2-5,this.button2.y=this.text2.y-this.text2.height/2-5,this.button2.setInteractive().on("pointerdown",(()=>{this.scene.start("howtoplay")})),this.button3=this.add.rectangle(0,0,0,0,240),this.text3=this.add.text(window.innerWidth/2,window.innerHeight/1.4,"Your Best Scores",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button3.width=this.text3.width+15,this.button3.height=this.text3.height+15,this.button3.x=this.text3.x-this.text3.width/2-5,this.button3.y=this.text3.y-this.text3.height/2-5,this.button3.setInteractive().on("pointerdown",(()=>{this.scene.start("bestscores")}))}update(){}}const r=l;class c extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"How To Play",{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/1.5,"Back",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+10,this.button.height=this.text.height+10,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",(()=>{this.scene.start("joinscene")}))}update(){}}const y=c;class g extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"You Died",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/2,"OK",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",(()=>{this.scene.start("joinscene")}))}update(){}}const p=g;class x extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"Your Best",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.add.text(window.innerWidth/2,300,"Score: "+localStorage.getItem("bestscore"),{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.add.text(window.innerWidth/2,400,"Gold: "+localStorage.getItem("bestgold"),{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/1.25,"Back",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",(()=>{this.scene.start("joinscene")}))}update(){}}const u=x;class w extends Phaser.Scene{constructor(){super()}preload(){}create(){this.disconnecttext=new i(this,window.innerWidth/2,100,"You got disconnected",{fontSize:50}).setOrigin(.5),this.button=new h(this,window.innerWidth/2,window.innerHeight/2,"OK",(()=>{location.reload()}))}update(){}}const f=w,m={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,backgroundColor:"#000000",physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}}};localStorage.getItem("name")&&!loggedIn&&(document.getElementById("input").value=localStorage.getItem("name")),document.getElementById("playbtn").addEventListener("click",(function(){let t=document.getElementById("input").value;if(!t.replace(/\s/g,""))return void(document.querySelector("p").style.display="block");localStorage.setItem("name",t);const e=new Phaser.Game(m);e.scene.add("gamescene",d),e.scene.add("joinscene",r),e.scene.add("howtoplay",y),e.scene.add("diedscene",p),e.scene.add("bestscores",u),e.scene.add("disconnect_scene",f),e.scene.start("gamescene"),document.querySelector("canvas").style.cursor="crosshair",window.addEventListener("resize",(()=>{e.scale.resize(window.innerWidth,window.innerHeight)})),document.querySelector("main").style.display="none"}))})();