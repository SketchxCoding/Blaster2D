(()=>{"use strict";var M={},O=window.innerWidth,P=window.innerHeight;const o=3e3,h=50,r=37.5,d=o/60,g=300;function p(s,e){return Math.round(Math.random()*(e-s))+s}function c(s,e,t){return!(s=="left"&&e<=0||s=="right"&&e+h>=o||s=="up"&&t<=0||s=="down"&&t+h>=o||s=="none")}const y=300,Y={arrows:0,pistol:30,rifle:100};class f extends Phaser.Scene{constructor(){super()}preload(){this.load.image("player","/img/player.png"),this.load.image("coin","/img/coin.png"),this.load.image("grass","/img/tile.png"),this.load.image("bullet","/img/bullet.png"),this.load.image("pistol","/img/pistol.png"),this.load.image("obstacle","/img/obstacle.png"),this.load.image("obstacle2","/img/obstacle2.png"),this.load.image("tree","/img/tree.png"),this.loadingtext=this.add.text(window.innerWidth/2,window.innerHeight/2,"Loading...",{fontFamily:"Arial",fontSize:50}).setOrigin(.5)}create(){this.loaded=!1,this.socket=io(),this.otherplayers=this.physics.add.group(),this.otherguns=this.physics.add.group(),this.coins=this.physics.add.group(),this.trees=this.physics.add.group(),this.socket.emit("join",localStorage.getItem("name")),this.socket.on("gamedata",e=>{this.loaded=!0,this.loadingtext.destroy(),this.player=this.physics.add.sprite(e.players[this.socket.id].x,e.players[this.socket.id].y,"player").setScale(.5,.5).setDepth(1),this.cameras.main.startFollow(this.player),this.data={x:e.players[this.socket.id].x,y:e.players[this.socket.id].y,angle:0,angle2:0};for(let t of e.coins){let i=this.coins.create(t.x,t.y,"coin").setScale(.75,.75).setDepth(1);i.id=t.id}for(let t of e.trees){let i=this.trees.create(t.x,t.y,"tree").setScale(t.size/g).setDepth(10);i.id=t.id}for(let t of Object.keys(e.players))if(t!=this.socket.id){let i=this.otherplayers.create(e.players[t].x,e.players[t].y,"player").setScale(.5,.5).setDepth(1);i.id=t;let n=this.otherguns.create(e.players[t].x+Math.cos(e.players[t].angle2)*(h/2+28),e.players[t].y+Math.sin(e.players[t].angle2)*(h/2+28),"pistol").setDepth(15);n.angle=e.players[t].angle,n.angle2=e.players[t].angle2,n.id=t}this.main()}),this.socket.on("new player",(e,t)=>{let i=this.otherplayers.create(e.x,e.y,"player").setScale(.5,.5).setDepth(1),n=this.otherguns.create(e.x+Math.cos(0)*(h/2+28),e.y+Math.sin(0)*(h/2+28),"pistol").setDepth(15);n.angle=0,n.angle2=0,i.id=t,n.id=t}),this.socket.on("other player move",(e,t,i,n,A)=>{this.otherplayers.getChildren().forEach(l=>{l.id==e&&(l.setPosition(t,i),l.angle=n,this.otherguns.getChildren().forEach(a=>{a.id==e&&(a.angle=n,a.angle2=A,a.x=l.body.position.x+h/2+Math.cos(a.angle2)*(h/2+28),a.y=l.body.position.y+h/2+Math.sin(a.angle2)*(h/2+28))}))})}),this.socket.on("collected gold",e=>{for(let t of this.coins.children.entries)t.id==e&&(t.destroy(),console.log("deleted coin"))}),this.socket.on("left",e=>{for(let t of this.otherplayers.children.entries)t.id==e&&t.destroy();for(let t of this.otherguns.children.entries)t.id==e&&t.destroy()}),this.socket.on("leave",()=>{this.scene.start("disconnect_scene")})}main(){this.w=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.a=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.s=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.d=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);for(let t=o/(d*2);t<o;t+=o/d)for(let i=o/(d*2);i<o;i+=o/d){let n=this.physics.add.image(t,i,"grass").setDepth(0)}this.obstacle1=this.physics.add.staticSprite(1500,750,"obstacle").setDepth(0),this.obstacle2=this.physics.add.staticSprite(1500,2250,"obstacle").setDepth(0),this.obstacle3=this.physics.add.staticSprite(750,1500,"obstacle2").setDepth(0),this.obstacle4=this.physics.add.staticSprite(2250,1500,"obstacle2").setDepth(0),this.gun=this.physics.add.sprite(this.player.x,this.player.y,"pistol").setDepth(15),this.gun.angle2=0,this.bullets=this.physics.add.group(),this.health=100,this.healthtext=this.add.text(100,50,"Health",{fontFamily:"Arial",fontSize:30}).setDepth(10),this.healthtext.scrollFactorX=0,this.healthtext.scrollFactorY=0,this.healthbar=this.add.rectangle(200,100,200,20,16777215).setDepth(10),this.healthbar.scrollFactorX=0,this.healthbar.scrollFactorY=0,this.healthbarinside=this.add.rectangle(200,100,200,20,6353420).setDepth(10),this.healthbarinside.scrollFactorX=0,this.healthbarinside.scrollFactorY=0,this.score=0,this.scoretext=this.add.text(window.innerWidth-200,100,"Score: "+this.score,{fontFamily:"Arial",fontSize:30}).setDepth(10),this.scoretext.scrollFactorX=0,this.scoretext.scrollFactorY=0,this.gold=0,this.goldtext=this.add.text(window.innerWidth-200,150,"Gold: "+this.gold,{fontFamily:"Arial",fontSize:30}).setDepth(10),this.goldtext.scrollFactorX=0,this.goldtext.scrollFactorY=0,this.addWeaponActions();var e=this;this.healFunction=setInterval(function(){e.health<100&&(e.health+=1,e.updateHealthBar())},1e3),this.physics.add.collider(this.player,this.coins,(t,i)=>{this.collect(t,i)}),this.physics.add.collider(this.bullets,this.obstacle1,(t,i)=>{i.destroy()}),this.physics.add.collider(this.player,this.obstacle1,()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)}),this.physics.add.collider(this.bullets,this.obstacle2,(t,i)=>{i.destroy()}),this.physics.add.collider(this.player,this.obstacle2,()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)}),this.physics.add.collider(this.bullets,this.obstacle3,(t,i)=>{i.destroy()}),this.physics.add.collider(this.player,this.obstacle3,()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)}),this.physics.add.collider(this.bullets,this.obstacle4,(t,i)=>{i.destroy()}),this.physics.add.collider(this.player,this.obstacle4,()=>{this.player.setVelocityX(0),this.player.setVelocityY(0)})}collect(e,t){this.socket.emit("collect gold",t.id),console.log(t.id),this.gold+=1,this.goldtext.setText("Gold: "+this.gold),t.destroy(),this.gold>localStorage.getItem("bestgold")&&localStorage.setItem("bestgold",this.gold);for(let i=0;i<p(0,2);i++)this.coins.create(p(r/2,o-r/2),p(r/2,o-r/2),"coin").setScale(.75,.75)}updateHealthBar(){this.health<0&&(this.health=0),this.healthbarinside.width=200*this.health/100}addWeaponActions(){this.useweapon=!0,window.addEventListener("mousedown",e=>{if(!this.useweapon)return;var t=Math.atan2(e.clientY-window.innerHeight/2,e.clientX-window.innerWidth/2);let i=this.bullets.create(this.player.x+Math.cos(t)*(h/2+23),this.player.y+Math.sin(t)*(h/2+23),"bullet").setScale(.5,2).setDepth(13);i.angle=(t*180/Math.PI+360)%360,i.setVelocityX(Math.cos(t)*1500),i.setVelocityY(Math.sin(t)*1500),this.gun.angle=(t*180/Math.PI+360)%360,this.gun.angle2=t,this.useweapon=!1}),window.addEventListener("mousemove",e=>{var t=Math.atan2(e.clientY-window.innerHeight/2,e.clientX-window.innerWidth/2);this.gun.angle=(t*180/Math.PI+360)%360,this.gun.angle2=t}),setInterval(()=>{this.useweapon||(this.useweapon=!0)},500)}update(){if(!this.loaded)return;let e=this.input.keyboard.createCursorKeys();this.player.setVelocityX(0),this.player.setVelocityY(0),(e.left.isDown||this.a.isDown)&&c("left",this.player.body.position.x,this.player.body.position.y)&&this.player.setVelocityX(-y),(e.right.isDown||this.d.isDown)&&c("right",this.player.body.position.x,this.player.body.position.y)&&this.player.setVelocityX(y),(e.up.isDown||this.w.isDown)&&c("up",this.player.body.position.x,this.player.body.position.y)&&this.player.setVelocityY(-y),(e.down.isDown||this.s.isDown)&&c("down",this.player.body.position.x,this.player.body.position.y)&&this.player.setVelocityY(y),this.gun.x=this.player.body.position.x+h/2+Math.cos(this.gun.angle2)*(h/2+28),this.gun.y=this.player.body.position.y+h/2+Math.sin(this.gun.angle2)*(h/2+28),this.player.angle=this.gun.angle,(this.player.x!=this.data.x||this.player.y!=this.data.y||this.player.angle!=this.data.angle)&&(this.data.x=this.player.x,this.data.y=this.player.y,this.data.angle=this.gun.angle,this.data.angle2=this.gun.angle2,this.socket.emit("player move",this.data.x,this.data.y,this.data.angle,this.data.angle2))}}const u=f;class w extends Phaser.Scene{constructor(){super()}preload(){}create(){localStorage.getItem("bestscore")||localStorage.setItem("bestscore",0),localStorage.getItem("bestgold")||localStorage.setItem("bestgold",0),this.add.text(window.innerWidth/2,100,"Game",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/2.5,"Play",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",()=>{this.scene.start("gamescene")}),this.button2=this.add.rectangle(0,0,0,0,240),this.text2=this.add.text(window.innerWidth/2,window.innerHeight/1.8,"How To Play",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button2.width=this.text2.width+15,this.button2.height=this.text2.height+15,this.button2.x=this.text2.x-this.text2.width/2-5,this.button2.y=this.text2.y-this.text2.height/2-5,this.button2.setInteractive().on("pointerdown",()=>{this.scene.start("howtoplay")}),this.button3=this.add.rectangle(0,0,0,0,240),this.text3=this.add.text(window.innerWidth/2,window.innerHeight/1.4,"Your Best Scores",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button3.width=this.text3.width+15,this.button3.height=this.text3.height+15,this.button3.x=this.text3.x-this.text3.width/2-5,this.button3.y=this.text3.y-this.text3.height/2-5,this.button3.setInteractive().on("pointerdown",()=>{this.scene.start("bestscores")})}update(){}}const x=w;class b extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"How To Play",{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/1.5,"Back",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+10,this.button.height=this.text.height+10,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",()=>{this.scene.start("joinscene")})}update(){}}const m=b;class S extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"You Died",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/2,"OK",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",()=>{this.scene.start("joinscene")})}update(){}}const I=S;class F extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"Your Best",{fontFamily:"Arial",fontSize:100}).setOrigin(.5),this.add.text(window.innerWidth/2,300,"Score: "+localStorage.getItem("bestscore"),{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.add.text(window.innerWidth/2,400,"Gold: "+localStorage.getItem("bestgold"),{fontFamily:"Arial",fontSize:75}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/1.25,"Back",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",()=>{this.scene.start("joinscene")})}update(){}}const D=F;class k extends Phaser.Scene{constructor(){super()}preload(){}create(){this.add.text(window.innerWidth/2,100,"You got disconnected",{fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button=this.add.rectangle(0,0,0,0,240),this.text=this.add.text(window.innerWidth/2,window.innerHeight/2,"OK",{fill:"#ffffff",fontFamily:"Arial",fontSize:50}).setOrigin(.5),this.button.width=this.text.width+15,this.button.height=this.text.height+15,this.button.x=this.text.x-this.text.width/2-5,this.button.y=this.text.y-this.text.height/2-5,this.button.setInteractive().on("pointerdown",()=>{location.reload()})}update(){}}const v=k,z={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,backgroundColor:"#000000",physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}}};function W(){let s=document.getElementById("input").value;if(!s.replace(" ","")){document.querySelector("p").style.display="block";return}localStorage.setItem("name",s);const e=new Phaser.Game(z);e.scene.add("gamescene",u),e.scene.add("joinscene",x),e.scene.add("howtoplay",m),e.scene.add("diedscene",I),e.scene.add("bestscores",D),e.scene.add("disconnect_scene",v),e.scene.start("gamescene"),document.querySelector("canvas").style.cursor="crosshair",window.addEventListener("resize",()=>{e.scale.resize(window.innerWidth,window.innerHeight)}),document.querySelector("main").style.display="none"}localStorage.getItem("name")&&(document.getElementById("input").value=localStorage.getItem("name")),document.getElementById("playbtn").addEventListener("click",W)})();
